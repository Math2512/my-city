services:
  php:
    container_name: ${PROJECT_NAME:-my-city}_app
    build:
      context: .
      target: frankenphp_dev
      dockerfile: docker/Dockerfile
    environment:
      SERVER_NAME: ${SERVER_NAME:-localhost}, php:80
      STABILITY: ${STABILITY:-stable}
    volumes:
      - caddy_data:/data
      - caddy_config:/config
    ports:
      - target: 80
        published: ${HTTP_PORT:-80}
        protocol: tcp
      - target: 5173
        published: ${VITE_PORT:-5173}
        protocol: tcp
    depends_on:
      - mysql
    networks:
      - my_city
    
  mysql:
    container_name: ${PROJECT_NAME:-my-city}_db
    image: 'mysql:8.0'
    ports:
      - '${FORWARD_DB_PORT:-3306}:3306'
    environment:
      MYSQL_ROOT_PASSWORD: '${MYSQL_ROOT_PASSWORD}'
      MYSQL_ROOT_HOST: '%'
      MYSQL_DATABASE: '${DB_DATABASE}'
      MYSQL_USER: '${DB_USERNAME}'
      MYSQL_PASSWORD: '${DB_PASSWORD}'
    volumes:
      - 'mysql_data:/var/lib/mysql'
      - './docker/mysql/create-testing-database.sh:/docker-entrypoint-initdb.d/10-create-testing-database.sh'
    networks:
      - my_city

networks:
  my_city:

volumes:
  caddy_data:
  caddy_config:
  mysql_data:
    driver: local
